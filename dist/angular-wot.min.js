var wot=angular.module("wot",["coap"]);angular.module("wot").factory("TdParser",["$http","CoAP",function(t,r){var e={},a=["xsd:byte","xsd:float","xsd:decimal","xsd:int","xsd:long","xsd:unsignedByte","xsd:unsignedShort"];e.isNumericType=function(t){return-1!=a.indexOf(t)};var n=function(t){var r={name:t.metadata.name,properties:[],actions:[],uri:t.metadata.protocols.HTTP?t.metadata.protocols.HTTP.uri:t.metadata.protocols.CoAP.uri,protocols:t.metadata.protocols};return t.interactions.filter(function(t){return"Property"==t["@type"]}).forEach(function(t){r.properties.push({name:t.name,writable:t.writable,xsdType:t.outputData,autoUpdate:!1,history:[],parent:r,isNumeric:e.isNumericType(t.outputData)})}),t.interactions.filter(function(t){return"Action"==t["@type"]}).forEach(function(t){r.actions.push({name:t.name,xsdParamType:t.inputData,xsdReturnType:t.outputData,parent:r})}),r},o=function(t){for(prefIdx=-1,i=0;i<t.length;i++){var r=t[i],e=r.substring(0,r.indexOf(":"));if("http"===e)return i;"coap"===e&&(prefIdx=i)}return prefIdx},u=function(t,r){return"/"===t.slice(-1)?t+r:t+"/"+r},p=function(t){var r=t.uris instanceof Array?t.uris:[t.uris],a=o(r);if(-1===a)throw Error("no suitable Protocols found");var n={name:t.name,properties:[],actions:[],uri:r[a]};return t.properties&&t.properties.forEach(function(t){n.properties.push({name:t.name,writable:t.writable,xsdType:t.valueType,type:t.valueType.type,uri:u(n.uri,t.hrefs[a]),autoUpdate:!1,history:[],parent:n,isNumeric:e.isNumericType(t.valueType),properties:t.valueType.properties})}),t.actions&&t.actions.forEach(function(t){var r=t.inputData?t.inputData.valueType.type:"";n.actions.push({name:t.name,xsdParamType:r,numericParamType:e.isNumericType(r),inputProperties:t.inputData?t.inputData.valueType.properties:"",xsdReturnType:t.outputData?t.outputData.valueType.type:"",parent:n,uri:u(n.uri,t.hrefs[a])})}),n};return e.createThing=function(t){return t.metadata?n(t):p(t)},e.fromUrl=function(a){return"coap"==a.substring(0,4)?r.get(a).then(function(t){return JSON.parse(t)}).then(e.createThing):t.get(a).then(function(t){return t.data}).then(e.createThing)},e.parseJson=function(t){var r=JSON.parse(t);return e.createThing(r)},e}]),angular.module("wot").factory("ThingClient",["$http","CoAP",function(t,r){var e={},a=function(e,a,n){var o=a.substring(0,a.indexOf(":"));if("http"===o){var u={method:e,url:a,data:n};return t(u)}if("coap"===o)return r.doCoapReq(e,a,JSON.stringify(n)).then(t.defaults.transformResponse);throw Error("unknown uri scheme")};return e.readProperty=function(e,n){function o(t){for(n.value=t,n.history.push(t);n.history.length>=20;)n.history.shift()}return n.uri?a("GET",n.uri).then(function(t){return t.data?t.data.value:JSON.parse(t).value}).then(o):e.protocols.HTTP?t.get(e.protocols.HTTP.uri+"/"+n.name).then(function(t){return t.data.value}).then(o):e.protocols.CoAP?r.get(e.protocols.CoAP.uri+"/"+n.name).then(function(t){return JSON.parse(t.payload).value}).then(o):void 0},e.writeProperty=function(e,n){return n.uri?a("PUT",n.uri,{value:n.value}):e.protocols.HTTP?t.put(e.protocols.HTTP.uri+"/"+n.name,{value:n.value}):r.put(e.protocols.CoAP.uri+"/"+n.name,{value:n.value})},e.callAction=function(e,n,o){var u={value:o};return"WoTScript"===n.xsdParamType&&(u=o),n.uri?a("POST",n.uri,u):e.protocols.HTTP?t.post(e.protocols.HTTP.uri+"/"+n.name,u):r.post(e.protocols.CoAP.uri+"/"+n.name,u)},e}]);
//# sourceMappingURL=angular-wot.min.js.map
