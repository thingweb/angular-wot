var wot=angular.module("wot",["coap"]);angular.module("wot").factory("TdParser",["$http","CoAP",function(t,e){var r={},n=["xsd:byte","xsd:float","xsd:decimal","xsd:int","xsd:long","xsd:unsignedByte","xsd:unsignedShort"];r.isNumericType=function(t){return n.indexOf(t)!=-1};var a=function(t){var e={name:t.metadata.name,properties:[],actions:[],uri:t.metadata.protocols.HTTP?t.metadata.protocols.HTTP.uri:t.metadata.protocols.CoAP.uri,protocols:t.metadata.protocols};return t.interactions.filter(function(t){return"Property"==t["@type"]}).forEach(function(t){e.properties.push({name:t.name,writable:t.writable,xsdType:t.outputData,autoUpdate:!1,history:[],parent:e,isNumeric:r.isNumericType(t.outputData)})}),t.interactions.filter(function(t){return"Action"==t["@type"]}).forEach(function(t){e.actions.push({name:t.name,xsdParamType:t.inputData,xsdReturnType:t.outputData,parent:e})}),e},u=function(t){for(prefIdx=-1,i=0;i<t.length;i++){var e=t[i],r=e.substring(0,e.indexOf(":"));if("http"===r)return i;"coap"===r&&(prefIdx=i)}return prefIdx},o=function(t,e){return 0==t.length?e:"/"===t.slice(-1)?t+e:t+"/"+e},p=function(t){var e,n;if(t.uris?(n=t.uris instanceof Array?t.uris:[t.uris],e=u(n)):(n=[""],e=0),e===-1)throw Error("no suitable Protocols found");var a={name:t.name,properties:[],actions:[],uri:n[e]};return t.properties&&t.properties.forEach(function(t){a.properties.push({name:t.name,writable:t.writable,xsdType:t.valueType,type:t.valueType.type,uri:o(a.uri,t.hrefs[e]),autoUpdate:!1,history:[],parent:a,isNumeric:r.isNumericType(t.valueType),properties:t.valueType.properties})}),t.actions&&t.actions.forEach(function(t){var n=t.inputData?t.inputData.valueType.type:"";a.actions.push({name:t.name,xsdParamType:n,numericParamType:r.isNumericType(n),inputProperties:t.inputData?t.inputData.valueType.properties:"",xsdReturnType:t.outputData?t.outputData.valueType.type:"",parent:a,uri:o(a.uri,t.hrefs[e])})}),a};r.createThing=function(t){if(t.metadata)return a(t);if(t.interactions){var e=c(t);return p(e)}return p(t)},r.fromUrl=function(n){return"coap"==n.substring(0,4)?e.get(n).then(function(t){return JSON.parse(t)}).then(r.createThing):t.get(n).then(function(t){return t.data}).then(r.createThing)},r.parseJson=function(t){var e=JSON.parse(t);return r.createThing(e)};var s=function(t){var e=JSON.parse(t);if(null!=e.base&&(e.uris=[],e.uris.push(e.base),delete e.base),null!=e.interactions&&Array.isArray(e.interactions)){for(var r=0,n=e.interactions;r<n.length;r++){var a=n[r];null!=a["@type"]&&Array.isArray(a["@type"])&&(a["@type"].indexOf("Property")>=0&&(null==e.properties&&(e.properties=[]),e.properties.push(a),null!=a.outputData&&null!=a.outputData.valueType&&(a.valueType=a.outputData.valueType,delete a.outputData),l(e,a)),a["@type"].indexOf("Action")>=0&&(null==e.actions&&(e.actions=[]),e.actions.push(a),l(e,a)),a["@type"].indexOf("Event")>=0&&(null==e.events&&(e.events=[]),e.events.push(a),null!=a.outputData&&null!=a.outputData.valueType&&(a.valueType=a.outputData.valueType,delete a.outputData),l(e,a)))}delete e.interactions}return e},l=function(t,e){if(null!=e.links&&Array.isArray(e.links)){for(var r=0,n=e.links;r<n.length;r++){var a=n[r];null==e.hrefs&&(e.hrefs=[]),e.hrefs.push(a.href),null==t.encodings&&(t.encodings=[]),t.encodings.indexOf(a.mediaType)<0&&t.encodings.push(a.mediaType)}delete e.links}},c=function(t){return s(JSON.stringify(t))};return r}]),angular.module("wot").factory("ThingClient",["$http","CoAP",function(t,e){var r={},n=function(r,n,a){var u=n.substring(0,n.indexOf(":"));if("http"===u){var o={method:r,url:n,data:a};return t(o)}if("coap"===u)return e.doCoapReq(r,n,JSON.stringify(a)).then(t.defaults.transformResponse);throw Error("unknown uri scheme")};return r.readProperty=function(r,a){function u(t){for(a.value=t,a.history.push(t);a.history.length>=20;)a.history.shift()}return a.uri?n("GET",a.uri).then(function(t){return t.data?t.data.value:JSON.parse(t).value}).then(u):r.protocols.HTTP?t.get(r.protocols.HTTP.uri+"/"+a.name).then(function(t){return t.data.value}).then(u):r.protocols.CoAP?e.get(r.protocols.CoAP.uri+"/"+a.name).then(function(t){return JSON.parse(t.payload).value}).then(u):void 0},r.writeProperty=function(r,a){return a.uri?n("PUT",a.uri,{value:a.value}):r.protocols.HTTP?t.put(r.protocols.HTTP.uri+"/"+a.name,{value:a.value}):e.put(r.protocols.CoAP.uri+"/"+a.name,{value:a.value})},r.callAction=function(r,a,u){var o={value:u};return"WoTScript"===a.xsdParamType&&(o=u),a.uri?n("POST",a.uri,o):r.protocols.HTTP?t.post(r.protocols.HTTP.uri+"/"+a.name,o):e.post(r.protocols.CoAP.uri+"/"+a.name,o)},r}]);
//# sourceMappingURL=angular-wot.min.js.map
